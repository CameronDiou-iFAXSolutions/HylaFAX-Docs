<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Inbound FAX Routing - HylaFAX Enterprise Guide</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css">

        <script src="../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">HylaFAX Enterprise Guide</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href="../../quickstart/" class="nav-link">Home</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Quickstart Guide <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../quickstart/appliance-installation/" class="dropdown-item">Getting Started</a>
</li>
                                    
<li>
    <a href="../../quickstart/installing-the-iso/" class="dropdown-item">Installing the iso</a>
</li>
                                    
<li>
    <a href="../../quickstart/activating-the-license/" class="dropdown-item">Activate License</a>
</li>
                                    
<li>
    <a href="../../quickstart/configure-networking/" class="dropdown-item">Configure Networking</a>
</li>
                                    
<li>
    <a href="../../quickstart/configuring-mail/" class="dropdown-item">Configuring Mail</a>
</li>
                                    
<li>
    <a href="../../quickstart/enabling-iFAX-support-access/" class="dropdown-item">Enabling iFAX Support Access</a>
</li>
                                    
<li>
    <a href="../../quickstart/configuring-telco-connections/" class="dropdown-item">Configuring Telco Connections</a>
</li>
                                    
<li>
    <a href="../../quickstart/configure-dialing-options/" class="dropdown-item">Configure Dialing Options</a>
</li>
                                    
<li>
    <a href="../../quickstart/web-interface-start-up/" class="dropdown-item">Web Interface Startup</a>
</li>
                                    
<li>
    <a href="../../quickstart/web-interface-admin-basics/" class="dropdown-item">Web Interface Admin Basics</a>
</li>
                                    
<li>
    <a href="../../quickstart/web-interface-DID-routes/" class="dropdown-item">Web Interface DID Routes</a>
</li>
                                    
<li>
    <a href="../../quickstart/notes/" class="dropdown-item">Notes</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Enterprise Guide <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../overview/" class="dropdown-item">Overview</a>
</li>
                                    
<li>
    <a href="../license-activation/" class="dropdown-item">License Activation</a>
</li>
                                    
<li>
    <a href="./" class="dropdown-item active">Inbound FAX Routing</a>
</li>
                                    
<li>
    <a href="../sending-faxes/" class="dropdown-item">Sending Faxes</a>
</li>
                                    
<li>
    <a href="../client-access/" class="dropdown-item">Client Access</a>
</li>
                                    
<li>
    <a href="../email-templates/" class="dropdown-item">Email Templates</a>
</li>
                                    
<li>
    <a href="../firewall-configuration/" class="dropdown-item">Firewall Configuration</a>
</li>
                                    
<li>
    <a href="../cron-jobs/" class="dropdown-item">Cron Jobs</a>
</li>
                                    
<li>
    <a href="../troubleshooting/" class="dropdown-item">Troubleshooting and FAQ</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../license-activation/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../sending-faxes/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#configuring-inbound-fax-routing" class="nav-link">Configuring Inbound FAX Routing</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#web-interface-did-routes" class="nav-link">Web Interface DID Routes:</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#fax-dispatch" class="nav-link">Fax Dispatch</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#fax-to-email-using-faxdispatch" class="nav-link">Fax to Email using FaxDispatch</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#copying-the-fax-to-a-local-directory" class="nav-link">Copying the FAX to a local directory</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#using-ldapad" class="nav-link">Using LDAP/AD</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#printing-received-faxes" class="nav-link">Printing Received Faxes</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#barcode-decoding" class="nav-link">Barcode Decoding</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="configuring-inbound-fax-routing">Configuring Inbound FAX Routing</h1>
<h2 id="web-interface-did-routes">Web Interface DID Routes:</h2>
<p>Inbound FAX routing is easily configured the "Configure DID/DTMF Routing" section of the Admin Settings area in the Web Interface.</p>
<p><img alt="Screenshot" src="../img/screenshot18.png" /></p>
<p>By default, there are three DID groups configured. They are <code>1234</code>, <code>1321</code>, and <code>4321</code>. If a fax is sent to a non-existent DID group, then it will be stored in the “Catch-All” group.</p>
<p>The <strong><em>admin</em></strong> account has access to view all faxes received in every DID group including the “Catch-All” group. </p>
<p>The <strong><em>tech</em></strong> account only has access to view the faxes received on the <code>1321</code> and <code>4321</code> DID groups.  The <strong><em>user</em></strong> account only has access to the <code>1234</code> DID group. </p>
<p>Therefore, if you send a fax to <code>4321</code>, the users <strong><em>admin</em></strong> and <strong><em>tech</em></strong> will see the fax in the Inbox while <strong><em>user</em></strong> will not. </p>
<p>If you send a fax to <code>2175</code>, only <strong><em>admin</em></strong> will be able to view the fax because it will be stored in the “Catch-All” group.</p>
<p>You can create new DID groups and adjust user permissions in the Admin Settings area.</p>
<h2 id="fax-dispatch">Fax Dispatch</h2>
<p>If you'd like to perform an action (e.g. execute a script) when a fax is received, that can happen on in FaxDispatch</p>
<p>FaxDispatch is sourced by bin/faxrcvd, which is executed by btgetty. Here are some things you can do with it:</p>
<ul>
<li>
<p>Email routing by CallerID, by DID, or by receiving device (example case statements for each type of routing are included). FaxDispatch sets the SENDTO variable in order to route faxes to emails. Similarly it sets FROMADDR. </p>
</li>
<li>
<p>Sending the fax attachment as different types (i.e., TIFF instead of PDF) FaxDispatch sets the FILETYPE variable to pdf,tiff to manage this. Or to "none" to not attach anything at all.  Or you can use TIFF instead of PDF for a specific destination, see below.</p>
</li>
<li>
<p>Automatic printing </p>
</li>
<li>Copying faxes to different directories (this is good for those who want backups or to send faxes to a different network share </li>
<li>Adding faxes to the web interface. </li>
<li>Set the TEMPLATE variable (or in FaxDispatch, add the variable, as it starts out not included in the file), to specify which email templates are used for notification</li>
</ul>
<h2 id="fax-to-email-using-faxdispatch">Fax to Email using FaxDispatch</h2>
<p>By default your server will have the following examples in its FaxDispatch file. You can see examples of how to route your emails based on the Caller ID <code>$CALLID1</code> or the DID Route <code>$CALLID2</code> or the device the fax was recived on <code>$DEVICE</code></p>
<p><em>When using multiple analog lines, you can determine which port the fax number is connected to by running  <code>watch faxstat</code> and then calling the fax numbers with your phone.</em></p>
<pre><code class="language-bash">FROMADDR=faxserver@example.com
FILETYPE=pdf
# By CallerID
case &quot;$CALLID1&quot; in
   2125551234) SENDTO=jack@example.com,jill@example.com;; # send to both jack and jill
   2125553456) SENDTO=&quot;joe@example.com&quot;; FILETYPE=tif;; # joe wants TIFF instead of PDF
   *) SENDTO=catchall@example.com;; # send everything else here
esac
# By DID/DTMF
case &quot;$CALLID2&quot; in
   6001) SENDTO=jack@example.com,jill@example.com;; # send to both jack and jill
   6002) SENDTO=&quot;joe@example.com&quot;; FILETYPE=tif;; # joe wants TIFF instead of PDF
   *) SENDTO=catchall@example.com;; # send everything else here
esac
# By Device
case &quot;$DEVICE&quot; in
   ttyS4) SENDTO=john@example.com;; # all faxes received on ttyS4
   ttyS5) SENDTO=mary@example.com;; # all faxes received on ttyS5
   ttyS6|ttyS7) SENDTO=will@example.com;; # all faxes received on ttyS6 and ttyS7
esac
</code></pre>
<h2 id="copying-the-fax-to-a-local-directory">Copying the FAX to a local directory</h2>
<p>To copy a fax in PDF format to another directory:</p>
<pre><code class="language-bash">DATE=$(date +%Y/%m)
TIFF2PDF=/usr/bin/tiff2pdf
SHAREDIR=/media/smbshare
if [ -f $FILE ]; then
   mkdir -p $SHAREDIR/$DATE
#   cp $FILE $SHAREDIR/$DATE/$FILENAME.tif
   # Copy the fax with filename format DID-FILENAME.pdf
   $TIFF2PDF -o $SHAREDIR/$DATE/$CALLID2-$FILENAME.pdf $FILE
fi
</code></pre>
<p><strong>Note about copying faxes:</strong></p>
<p>If you want to back up every received fax, ideally your remote machine would connect to a Samba share on the HylaFAX server, instead of configuring the HylaFAX server to connect to and store faxes on a remote share because of eventual networking problems that might cause some faxes to not be copied over to the remote share.</p>
<p>We recommend your systems pull from the HylaFAX server for an important reason: so that HylaFAX is guaranteed to be able to invoke all post-reception routines successfully, without reliance on external systems or file storage. HylaFAX's faxrcvd script only runs once, when the fax is received. If your remote filesystem was not mounted at the time it was run, the fax would fail to get copied over, and there would be no indication of any failure. So at least the very first copy HylaFAX does should be local.</p>
<p>*Add link to Samba setup guide</p>
<h2 id="using-ldapad">Using LDAP/AD</h2>
<p>Connection to LDAP server must be set up first! See guide below for instructions:</p>
<p>*Create a link to the LDAP doc</p>
<p>Route the fax to email based on the DID listed for users in LDAP (or Active Directory):</p>
<pre><code class="language-bash">LDAPEMAIL=`ldapsearch -LLL -x -D &quot;CN=Fax Server,OU=System Accounts,DC=Example,DC=com&quot; \
-y /etc/ldap.secret &quot;facsimileTelephoneNumber=*$CALLID2&quot; mail | grep &quot;^mail:&quot; | \
cut -f 2 -d ' ' | awk '{ str1=str1 $0 &quot;,&quot; }END{ print str1 }'`

if [ -n &quot;$LDAPEMAIL&quot; ]; then
        SENDTO=$LDAPEMAIL
fi
</code></pre>
<p>You must update the LDAP connection parameters (ie: LDAP host, BaseDN, etc) in the command above.</p>
<h2 id="printing-received-faxes">Printing Received Faxes</h2>
<p>Printing Received Faxes
To install the CUPS print queue software, run:</p>
<pre><code class="language-bash"> yum -y install cups system-config-printer
 systemctl start cups
 cupsctl --remote-admin
</code></pre>
<p>Edit /etc/cups/cuspd.conf and add this as the first line:</p>
<pre><code class="language-bash">DefaultEncryption Never
</code></pre>
<p>Under <code>&lt;Location /admin&gt;</code>, remove the line:</p>
<pre><code class="language-bash">Encryption Required
</code></pre>
<p>If the HylaFAX server is not located on your same network, you must also execute the following command:</p>
<pre><code class="language-bash"># sed -i -e 's/Allow @LOCAL/Allow All/' /etc/cups/cupsd.conf
</code></pre>
<p>Restart CUPS</p>
<pre><code class="language-bash"># systemctl restart cups
</code></pre>
<p>Allow connections to CUPS through the local firewall:</p>
<pre><code class="language-bash"># firewall-cmd --zone=public --permanent --add-service=ipp
# firewall-cmd --reload
</code></pre>
<p>Afterwards, you can access the CUPS web interface by pointing your browser to port 631 of your hylafax server’s IP address. </p>
<p>For example: http://192.168.1.10:631</p>
<p>*Add screenshot</p>
<p>To add a printer, click on the <code>Add Printer</code> button and follow the prompts. CUPS will request that you
login with the root account and the root password you specified during the Appliance installation.
To print faxes as they arrive, add the following to etc/FaxDispatch:</p>
<pre><code class="language-bash">PRINTER=myprinter
fax2ps $FILE | lpr -P$PRINTER
</code></pre>
<p>Substitute <code>myprinter</code> for the actual printer name configured on your server.</p>
<h2 id="barcode-decoding">Barcode Decoding</h2>
<p>Barcode support is provided by the bardecode application located at <code>/var/spool/hylafax/bin/bardecode</code>. Supported barcode types include code39, code128, upca, upce, ean8, code25, ean13 and codabar.</p>
<p>Example usage:</p>
<pre><code class="language-bash">bin/bardecode -t any -f $FILE
</code></pre>
<p>Execute <code>bin/bardecode</code> for more information</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js" defer></script>
        <script src="../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
